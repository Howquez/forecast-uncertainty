{% extends "global/Page.html" %}
{% load otree static %}

{% block scripts %}
    <script src="https://code.highcharts.com/highcharts.js"></script>
    <script src="https://code.highcharts.com/highcharts-more.js"></script>
    <script src="https://code.highcharts.com/modules/exporting.js"></script>
    <script src="https://code.highcharts.com/modules/export-data.js"></script>
    <script src="https://code.highcharts.com/modules/accessibility.js"></script>
    <script src="https://code.highcharts.com/modules/pattern-fill.js"></script>
    <script src="https://code.highcharts.com/modules/broken-axis.js"></script>
    <script src="{% static 'global/js/revelation_viz.js' %}"></script>
    <script src="{% static 'global/js/event_bar.js' %}"></script>

{% endblock %}

{% block content %}
<body onload="fillText()">
<img src="{% static 'global/images/cool-background.svg' %}" id="bg" alt=""/>


    <div class="card mt-5">
        <div class="card-body">
            <h5 class="card-title display-4">{{ participant.vars.location }} Oktober 2020</h5>
            <h6 class="card-subtitle mb-2 text-muted">Am <b>Sonntag</b>, dem 18. Oktober um 14:00 Uhr wurden hier
                <b><span id="revelation"></span>°C</b> gemessen.
            </h6>
            <br>
            <figure class="highcharts-figure">
                <div id="weather_viz"></div>
            </figure>
            <p class="card-text">
                <small>Der Wetterbericht den wir Ihnen gezeigt haben und auf dem Ihre Entscheidungen sowie
                Ihre möglichen Auszahlungen basieren, bezieht sich auf das Wetter in {{ participant.vars.location }}
                {% if participant.vars.location == "Ilomantsi" %}
                        (Finnland)
                {% else %}
                        (Saarland)
                    {% endif %}
                im Oktober 2020.
                Die Messdaten, die dieser Studie zugrunde liegen und für Ihre Auszahlung relevant sind, finden Sie
                {% if participant.vars.location == "Ilomantsi" %}
                    <a href="https://kachelmannwetter.com/de/messwerte/ostfinnland/temperatur/20201019-1100z.html#obs-detail-029390-72h" target="_blank">hier</a> und
                    <a href="https://kachelmannwetter.com/de/messwerte/ostfinnland/temperatur/20201009-1100z.html#obs-detail-029390-72h" target="_blank">hier</a>.
                {% else %}
                    <a href="https://kachelmannwetter.com/de/messwerte/63-e-491-n/temperatur/20201009-1100z.html#obs-detail-J728-72h" target="_blank">hier</a> und
                    <a href="https://kachelmannwetter.com/de/messwerte/63-e-491-n/temperatur/20201019-1100z.html#obs-detail-J728-72h" target="_blank">hier</a>.
                {% endif %}
                Die Wettervorhersage, die wir Ihnen ab der zweiten Runde dargestellt haben, stammen von ebenfalls von
                Kachelmannwetter und wurden mithilfe des Global Euro HD (ECMMF) Ensambles berechnet. Wir haben die Daten
                am 09.10.2020 um {% if participant.vars.location == "Ilomantsi" %}15:59{%else%}14:29{%endif%} Uhr (MEZ)
                abgerufen wie Sie <a data-toggle="collapse" href="#collapseExample" role="button" aria-expanded="false" aria-controls="collapseExample">
                diesem Screenshot (unten)</a> entnehmen können.
                </small>
            </p>
        </div>
        <div class="collapse card-footer bg-light text-secondary" id="collapseExample">
            {% if participant.vars.location == "Ilomantsi" %}
                <img class="d-block w-100" src="{% static 'terminate/images/Ilomantsi_Forecast.png' %}" alt="Wettervorhersage für {{ participant.vars.location }}">
            {% else %}
                <img class="d-block w-100" src="{% static 'terminate/images/Weiskirchen_Forecast.png' %}" alt="Wettervorhersage für {{ participant.vars.location }}">
            {% endif %}

        </div>
    </div>


    <div class="card mt-5">
        <div class="card-body">
            <h1 class="display-4 mb-4"><small class="text-muted">Sie bekommen</small> {{participant.payoff_plus_participation_fee}}<small class="text-muted"> ausgezahlt.</small></h1>
            <hr class="my-4">
            <p>
                Hier steht Text zur Abwicklung der Zahlung. Also was die nächsten Schritte sind und wann die Befragten
                mit dem Zahlungseingang rechnen können. Weil dies vom Dienstleister abhängt, bleibt es vorerst bei
                diesem Platzhalter-Text.
            </p>
            <p>
                Unten erklären wir Ihnen,
                wie Ihre Auszahlung zustande kommt &mdash; also welche Entscheidungssituation für Ihre Auszahlung relevant
                ist und wie Sie sich dort entschieden haben.
            </p>
        </div>

        <div id="accordion" role="tablist">
            <div class="card-header bg-white" role="tab" id="headingOne">
                <p class="lead mb-1">
                    <a data-toggle="collapse" href="#collapseOne" aria-expanded="false" aria-controls="collapseOne" class="collapsed">
                        <small>
                            Details anzeigen
                            <svg width="1em" height="1em" viewBox="0 0 16 16" class="bi bi-chevron-down" fill="currentColor" xmlns="http://www.w3.org/2000/svg">
                                <path fill-rule="evenodd" d="M1.646 4.646a.5.5 0 0 1 .708 0L8 10.293l5.646-5.647a.5.5 0 0 1 .708.708l-6 6a.5.5 0 0 1-.708 0l-6-6a.5.5 0 0 1 0-.708z"/>
                            </svg>
                        </small>
                    </a>
                </p>
            </div>

            <div id="collapseOne" class="collapse" role="tabpanel" aria-labelledby="headingOne" data-parent="#accordion">
                <div class="card-footer bg-white">
                    <p>
                        Es wurde zufällig bestimmt, dass Ihre Angaben aus <strong>{{ participant.vars.payment_task }}</strong>
                        Ihre Auszahlung bestimmen.

                        {% if winning_app == "Baillon" %}
                        Darüber hinaus wurde zufällig bestimmt, dass <strong>Entscheidungssituation
                        {{ participant.vars.baillon_round_to_pay }}</strong> Ihre Auszahlung bestimmt.
                        {% endif %}
                        In genau dieser Entscheidungssituation haben Sie {{ participant.vars.payment_outcome }}.
                    </p>
                    {% if winning_app == "MPP" %}
                        <div id="table-wrapper">
                            <div class="table-responsive" id="table-scroll">
                                <table class="table">
                                    <thead>
                                        <tr>
                                            <th scope="col">Kosten</th>
                                            <th scope="col">Ihre Schätzung</th>
                                            <th scope="col">Differenz</th>
                                            <th scope="col">Einbußen</th>
                                            <th scope="col">Chance</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <tr>
                                            <td>Überschätzen ist teurer</td>
                                            <td>{{ guess1 }}°C</td>
                                            <td>{{ diff1 }}°C</td>
                                            <td>{%if loss1 > 1%}-{%endif%}{{ loss1 }} <small>PP</small></td>
                                            <td rowspan="3" style="vertical-align: middle">{{ chance }}%</td>
                                        </tr>
                                        <tr>
                                            <td>Beides gleich teuer</td>
                                            <td>{{ guess2 }}°C</td>
                                            <td>{{ diff2 }}°C</td>
                                            <td>{%if loss2 > 1%}-{%endif%}{{ loss2 }} <small>PP</small></td>

                                        </tr>
                                        <tr>
                                            <td>Unterschätzen ist teurer</td>
                                            <td>{{ guess3 }}°C</td>
                                            <td>{{ diff3 }}°C</td>
                                            <td>{%if loss3 > 1%}-{%endif%}{{ loss3 }} <small>PP</small></td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        </div>

                        <p>
                            In diesem Fall hatten Sie, wie Sie in der rechten Spalte sehen, eine Gewinnchance von
                            <strong>{{ chance }}%</strong>. Sie können sich also wieder vorstellen, dass eine Kugel aus einer
                            Urne mit 100 Kugeln gezogen wird. {{ chance }} Kugeln sind dabei grün. Wird eine grüne Kugel gezogen
                            gewinnen Sie.
                        </p>
                        {% if participant.vars.payment_outcome == "gewonnen" %}
                            <p>
                                Weil die zufällig gezogene Kugel grün war, haben Sie <strong>gewonnen und in dieser Situation
                                {{ participant.payoff }} verdient</strong>.
                            </p>
                        {% else %}
                            <p>
                                Weil die zufällig gezogene Kugel rot war, haben Sie <strong> leider nicht gewonnen und in dieser
                                Situation {{ participant.payoff }} verdient</strong>.
                            </p>
                        {% endif %}

                    {% else %}
                        <p>
                            In der ausgewählten Entscheidungssituation hatten Sie die Wahl zwischen einer Lotterie und einer
                            Wette. Die Wette sah dabei wie folgt aus:
                        </p>

                        <div class="container clearfix border-left border-primary w-75 mb-3 bg-light">
                           <br>
                            <p id="subHeader">
                                <em>Sie gewinnen 10 Euro entsprechend der unten dargestellten Grafik (und sonst nichts).</em>
                            </p>

                            <figure class="highcharts-figure">
                                <div id="event_bar"></div>
                            </figure>
                        </div>

                        <p>
                            Sie haben angegeben, dass Sie eine Lotterie erst dann besser als die Wette finden, wenn sich
                            mindestens {{ pivotal_equivalent }} grüne Kugeln in der Urne befinden. Die Urne, die im Hintergrund
                            vorbereitet wurde, enthält {{ chance }} grüne Kugeln.
                        </p>

                        <p>
                            <strong>
                                Deshalb wird Ihre Auszahlung in dieser Aufgabe
                                durch die {{ payment_mechanism }} bestimmt.
                            </strong>
                        </p>

                        {% if payment_mechanism == "Wette" %}
                        <p>
                            Weil tatsächlich <strong>{{ participant.vars.observed_temp }}°C</strong> gemessen wurden, haben Sie
                            <strong>
                            {{ participant.vars.payment_outcome }} und in dieser Situation {{ participant.payoff }} verdient
                            </strong>.
                        </p>
                        {% else %}
                        <p>
                            Sie haben sich also dafür entschieden, die Lotterie zu spielen, bei der zufällig eine Kugel
                            aus einer Urne mit 100 Kugeln gezogen wird und bei der Sie gewinnen, wenn die zufällig gezogene
                            Kugel grün ist. Die Urne enthielt in diesem Fall {{chance}} grüne Kugeln und <strong> die
                            zufällig gezogene Kugel war {% if participant.vars.payment_outcome == "gewonnen" %} grün.
                            {% else %} rot. {% endif %}</strong>
                        </p>
                        <p>
                            <strong>Daher haben Sie {{ participant.vars.payment_outcome }} und in dieser Entscheidung
                            {{ participant.payoff }} verdient</strong>.
                        </p>
                        {% endif %}

                    {% endif %}
                </div>
            </div>
        </div>
    </div>



</body>
{% endblock %}


